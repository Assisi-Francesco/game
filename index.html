<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ì„  ì—­ì‚¬ ì±Œë¦°ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            padding: 30px;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #1a1a2e;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 0.95rem;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e94560;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        .hearts {
            font-size: 1.5rem;
            letter-spacing: 5px;
        }

        .combo {
            color: #ff9800 !important;
        }

        .mode-select {
            text-align: center;
        }

        .mode-btn {
            width: 100%;
            padding: 20px;
            margin: 10px 0;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .mode-timeline {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .mode-ox {
            background: linear-gradient(135deg, #e94560, #0f3460);
            color: white;
        }

        .mode-desc {
            font-size: 0.85rem;
            font-weight: normal;
            opacity: 0.9;
            margin-top: 5px;
        }

        .question-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-text {
            font-size: 1.2rem;
            color: #333;
            line-height: 1.6;
            text-align: center;
        }

        .ox-buttons {
            display: flex;
            gap: 15px;
        }

        .ox-btn {
            flex: 1;
            padding: 25px;
            font-size: 2.5rem;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .ox-btn:hover {
            transform: scale(1.05);
        }

        .ox-btn:active {
            transform: scale(0.95);
        }

        .btn-o {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
        }

        .btn-x {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .ox-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .timeline-instruction {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .timeline-cards {
            min-height: 300px;
        }

        .timeline-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
        }

        .timeline-card:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .timeline-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .timeline-card.correct {
            background: linear-gradient(135deg, #4caf50, #45a049);
        }

        .timeline-card.incorrect {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .card-year {
            font-size: 0.85rem;
            opacity: 0;
            margin-top: 5px;
        }

        .timeline-card.show-year .card-year {
            opacity: 0.8;
        }

        .card-event {
            font-weight: bold;
        }

        .feedback {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            display: block;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            display: block;
        }

        .feedback .explanation {
            font-weight: normal;
            font-size: 0.9rem;
            margin-top: 8px;
            line-height: 1.4;
        }

        .btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #9e9e9e, #757575);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
        }

        .result {
            text-align: center;
        }

        .result-score {
            font-size: 4rem;
            font-weight: bold;
            color: #e94560;
            margin: 20px 0;
        }

        .result-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }

        .result-grade {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .timer-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.1s linear;
        }

        .timer-fill.warning {
            background: linear-gradient(90deg, #ff9800, #ffc107);
        }

        .timer-fill.danger {
            background: linear-gradient(90deg, #f44336, #e91e63);
        }

        .hidden {
            display: none !important;
        }

        .level-select {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .level-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .level-btn.active {
            background: #667eea;
            color: white;
        }

        .progress-text {
            text-align: center;
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì¡°ì„  ì—­ì‚¬ ì±Œë¦°ì§€</h1>
        <p class="subtitle">ì¡°ì„  ì „ê¸°ì˜ ì—­ì‚¬ë¥¼ ê²Œì„ìœ¼ë¡œ ë°°ì›Œë³´ì„¸ìš”!</p>

        <!-- ë©”ì¸ ë©”ë‰´ -->
        <div id="menu" class="mode-select">
            <button class="mode-btn mode-ox" onclick="startOXQuiz()">
                OX ìŠ¤í”¼ë“œ í€´ì¦ˆ
                <div class="mode-desc">ë¹ ë¥´ê²Œ OXë¥¼ ë§ì¶°ë³´ì„¸ìš”!</div>
            </button>
            <button class="mode-btn mode-timeline" onclick="startTimeline()">
                íƒ€ì„ë¼ì¸ ì •ë ¬
                <div class="mode-desc">ì—­ì‚¬ì  ì‚¬ê±´ì„ ìˆœì„œëŒ€ë¡œ ë°°ì—´í•˜ì„¸ìš”</div>
            </button>
        </div>

        <!-- OX í€´ì¦ˆ ê²Œì„ -->
        <div id="oxGame" class="hidden">
            <div class="stats">
                <div class="stat">
                    <div class="stat-value hearts" id="oxHearts">â¤ï¸â¤ï¸â¤ï¸</div>
                    <div class="stat-label">ë¼ì´í”„</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="oxScore">0</div>
                    <div class="stat-label">ì ìˆ˜</div>
                </div>
                <div class="stat">
                    <div class="stat-value combo" id="oxCombo">x1</div>
                    <div class="stat-label">ì½¤ë³´</div>
                </div>
            </div>

            <div class="timer-bar">
                <div class="timer-fill" id="timerFill"></div>
            </div>

            <div class="progress-text" id="oxProgress">1 / 20</div>

            <div class="question-box">
                <div class="question-text" id="oxQuestion">ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>

            <div class="feedback" id="oxFeedback">
                <span id="feedbackText"></span>
                <div class="explanation" id="feedbackExplanation"></div>
            </div>

            <div class="ox-buttons" id="oxButtons">
                <button class="ox-btn btn-o" onclick="answerOX(true)">O</button>
                <button class="ox-btn btn-x" onclick="answerOX(false)">X</button>
            </div>

            <button class="btn btn-secondary" onclick="backToMenu()">ë©”ë‰´ë¡œ</button>
        </div>

        <!-- íƒ€ì„ë¼ì¸ ê²Œì„ -->
        <div id="timelineGame" class="hidden">
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="tlRound">1</div>
                    <div class="stat-label">ë¼ìš´ë“œ</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="tlScore">0</div>
                    <div class="stat-label">ì ìˆ˜</div>
                </div>
            </div>

            <div class="level-select">
                <button class="level-btn active" onclick="setLevel(3)">ì‰¬ì›€</button>
                <button class="level-btn" onclick="setLevel(4)">ë³´í†µ</button>
                <button class="level-btn" onclick="setLevel(5)">ì–´ë ¤ì›€</button>
            </div>

            <p class="timeline-instruction">ì¹´ë“œë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì„¸ìš”<br>(ìœ„ â†’ ì•„ë˜: ê³¼ê±° â†’ í˜„ì¬)</p>

            <div class="timeline-cards" id="timelineCards"></div>

            <div class="feedback" id="tlFeedback"></div>

            <button class="btn btn-success" id="checkOrderBtn" onclick="checkTimelineOrder()">ìˆœì„œ í™•ì¸</button>
            <button class="btn btn-primary hidden" id="nextRoundBtn" onclick="nextTimelineRound()">ë‹¤ìŒ ë¼ìš´ë“œ</button>
            <button class="btn btn-secondary" onclick="backToMenu()">ë©”ë‰´ë¡œ</button>
        </div>

        <!-- ê²°ê³¼ í™”ë©´ -->
        <div id="result" class="result hidden">
            <h2>ê²Œì„ ì¢…ë£Œ!</h2>
            <div class="result-score" id="finalScore">0</div>
            <div class="result-text" id="resultText">ì </div>
            <div class="result-grade" id="resultGrade"></div>
            <button class="btn btn-primary" onclick="backToMenu()">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // ============ OX í€´ì¦ˆ ë°ì´í„° ============
        const oxQuestions = [
            { q: "ì¡°ì„ ì€ 1392ë…„ì— ê±´êµ­ë˜ì—ˆë‹¤.", a: true, exp: "ì´ì„±ê³„ê°€ 1392ë…„ì— ì¡°ì„ ì„ ê±´êµ­í–ˆìŠµë‹ˆë‹¤." },
            { q: "í›ˆë¯¼ì •ìŒì€ ì„¸ì¢…ëŒ€ì™•ì´ ë§Œë“¤ì—ˆë‹¤.", a: true, exp: "ì„¸ì¢…ëŒ€ì™•ì´ 1443ë…„ì— í›ˆë¯¼ì •ìŒì„ ì°½ì œí–ˆìŠµë‹ˆë‹¤." },
            { q: "í›ˆë¯¼ì •ìŒì€ 'ë°±ì„±ì„ ê°€ë¥´ì¹˜ëŠ” ë°”ë¥¸ ì†Œë¦¬'ë¼ëŠ” ëœ»ì´ë‹¤.", a: true, exp: "í›ˆë¯¼ì •ìŒ(è¨“æ°‘æ­£éŸ³)ì€ ë°±ì„±ì„ ê°€ë¥´ì¹˜ëŠ” ë°”ë¥¸ ì†Œë¦¬ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤." },
            { q: "í›ˆë¯¼ì •ìŒì€ ì´ 28ìì´ë‹¤.", a: true, exp: "í›ˆë¯¼ì •ìŒì€ ìŠ¤ë¬¼ì—¬ëŸ ìë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤." },
            { q: "ì´ì„±ê³„ëŠ” ìœ„í™”ë„ì—ì„œ êµ°ëŒ€ë¥¼ ëŒì´ì¼œ ê¶Œë ¥ì„ ì¡ì•˜ë‹¤.", a: true, exp: "1388ë…„ ìœ„í™”ë„ íšŒêµ°ìœ¼ë¡œ ì´ì„±ê³„ê°€ ê¶Œë ¥ì„ ì¥ì•…í–ˆìŠµë‹ˆë‹¤." },
            { q: "ì¡°ì„ ì˜ ì²« ë²ˆì§¸ ìˆ˜ë„ëŠ” í•œì–‘ì´ì—ˆë‹¤.", a: false, exp: "ì¡°ì„  ê±´êµ­ í›„ 1394ë…„ì— ìˆ˜ë„ë¥¼ í•œì–‘ìœ¼ë¡œ ì˜®ê²¼ìŠµë‹ˆë‹¤. ì²˜ìŒì—” ê°œê²½ì´ì—ˆìŠµë‹ˆë‹¤." },
            { q: "ê²½êµ­ëŒ€ì „ì€ ì¡°ì„ ì˜ ë²•ì „ì´ë‹¤.", a: true, exp: "ê²½êµ­ëŒ€ì „ì€ ì„±ì¢… ë•Œ ì™„ì„±ëœ ì¡°ì„ ì˜ ê¸°ë³¸ ë²•ì „ì…ë‹ˆë‹¤." },
            { q: "ì•™ë¶€ì¼êµ¬ëŠ” ë¬¼ì‹œê³„ì´ë‹¤.", a: false, exp: "ì•™ë¶€ì¼êµ¬ëŠ” í•´ì‹œê³„ì´ê³ , ë¬¼ì‹œê³„ëŠ” ìê²©ë£¨ì…ë‹ˆë‹¤." },
            { q: "ìê²©ë£¨ëŠ” ìë™ìœ¼ë¡œ ì‹œê°„ì„ ì•Œë ¤ì£¼ëŠ” ë¬¼ì‹œê³„ì´ë‹¤.", a: true, exp: "ìê²©ë£¨ëŠ” ë¬¼ì´ íë¥´ë©´ ìë™ìœ¼ë¡œ ì¢…ì„ ì³ì„œ ì‹œê°„ì„ ì•Œë ¤ì¤¬ìŠµë‹ˆë‹¤." },
            { q: "ì¥ì˜ì‹¤ì€ ì‹ ë¶„ì´ ë‚®ì•˜ì§€ë§Œ ê³¼í•™ ê¸°êµ¬ë¥¼ ë§Œë“¤ì—ˆë‹¤.", a: true, exp: "ì„¸ì¢…ì€ ì‹ ë¶„ì´ ë‚®ì€ ì¥ì˜ì‹¤ì„ ê´€ë¦¬ë¡œ ë½‘ì•„ ê¸°ìˆ ì„ ì—°êµ¬í•˜ê²Œ í–ˆìŠµë‹ˆë‹¤." },
            { q: "ì¸¡ìš°ê¸°ëŠ” ë°”ëŒì˜ ì„¸ê¸°ë¥¼ ì¸¡ì •í•˜ëŠ” ê¸°êµ¬ì´ë‹¤.", a: false, exp: "ì¸¡ìš°ê¸°ëŠ” ê°•ìš°ëŸ‰(ë¹„ì˜ ì–‘)ì„ ì¸¡ì •í•˜ëŠ” ê¸°êµ¬ì…ë‹ˆë‹¤." },
            { q: "ì„ì§„ì™œë€ì€ 1592ë…„ì— ì¼ì–´ë‚¬ë‹¤.", a: true, exp: "1592ë…„ ì¼ë³¸ì´ ì¡°ì„ ì„ ì¹¨ëµí•˜ì—¬ ì„ì§„ì™œë€ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤." },
            { q: "ì„ì§„ì™œë€ ë•Œ ì´ìˆœì‹ ì€ ìœ¡ì§€ì—ì„œ ì‹¸ì› ë‹¤.", a: false, exp: "ì´ìˆœì‹ ì€ ìˆ˜êµ°(í•´êµ°)ì„ ì´ëŒê³  ë°”ë‹¤ì—ì„œ ì¼ë³¸êµ°ê³¼ ì‹¸ì› ìŠµë‹ˆë‹¤." },
            { q: "í•œì‚°ë„ ëŒ€ì²©ì—ì„œ í•™ìµì§„ ì „ìˆ ì´ ì‚¬ìš©ë˜ì—ˆë‹¤.", a: true, exp: "ì´ìˆœì‹ ì˜ ìˆ˜êµ°ì´ í•™ì´ ë‚ ê°œë¥¼ í¼ì¹˜ëŠ” ëª¨ì–‘ì˜ í•™ìµì§„ ì „ìˆ ë¡œ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤." },
            { q: "ì˜ë³‘ì€ ë‚˜ë¼ì—ì„œ ì¡°ì§í•œ ì •ê·œ êµ°ëŒ€ì´ë‹¤.", a: false, exp: "ì˜ë³‘ì€ ë°±ì„±ì´ ìë°œì ìœ¼ë¡œ ì¡°ì§í•œ êµ°ëŒ€ì…ë‹ˆë‹¤." },
            { q: "ê³½ì¬ìš°ëŠ” ì„ì§„ì™œë€ ë•Œ í™œì•½í•œ ì˜ë³‘ì¥ì´ë‹¤.", a: true, exp: "ê³½ì¬ìš°ëŠ” ì˜ë ¹ì—ì„œ ì˜ë³‘ì„ ì¼ìœ¼í‚¨ ëŒ€í‘œì ì¸ ì˜ë³‘ì¥ì…ë‹ˆë‹¤." },
            { q: "í–‰ì£¼ ëŒ€ì²©ì—ì„œ ê¶Œìœ¨ ì¥êµ°ì´ ìŠ¹ë¦¬í•˜ì˜€ë‹¤.", a: true, exp: "ê¶Œìœ¨ì´ ì´ë„ëŠ” ê´€êµ°ì´ í–‰ì£¼ì‚°ì„±ì—ì„œ ì¼ë³¸êµ°ì„ ë¬¼ë¦¬ì³¤ìŠµë‹ˆë‹¤." },
            { q: "ë³‘ìí˜¸ë€ ë•Œ ì¸ì¡°ëŠ” ë‚¨í•œì‚°ì„±ìœ¼ë¡œ í”¼ë€í•˜ì˜€ë‹¤.", a: true, exp: "1636ë…„ ë³‘ìí˜¸ë€ ë•Œ ì¸ì¡°ëŠ” ë‚¨í•œì‚°ì„±ìœ¼ë¡œ í”¼ë€í–ˆìŠµë‹ˆë‹¤." },
            { q: "ë³‘ìí˜¸ë€ì€ ì¼ë³¸ì˜ ì¹¨ëµìœ¼ë¡œ ì¼ì–´ë‚¬ë‹¤.", a: false, exp: "ë³‘ìí˜¸ë€ì€ ì²­ë‚˜ë¼ì˜ ì¹¨ëµìœ¼ë¡œ ì¼ì–´ë‚¬ìŠµë‹ˆë‹¤." },
            { q: "ì¡°ì„ ì€ ìœ êµë¥¼ ë‚˜ë¼ì˜ í†µì¹˜ ì›ë¦¬ë¡œ ì‚¼ì•˜ë‹¤.", a: true, exp: "ì¡°ì„ ì€ ìœ êµì˜ ê°€ë¥´ì¹¨ì— ë”°ë¼ ë‚˜ë¼ë¥¼ ë‹¤ìŠ¤ë ¸ìŠµë‹ˆë‹¤." },
            { q: "ì‚¼ê°•í–‰ì‹¤ë„ëŠ” ìœ êµì˜ ê°€ë¥´ì¹¨ì„ ê¸€ê³¼ ê·¸ë¦¼ìœ¼ë¡œ ì„¤ëª…í•œ ì±…ì´ë‹¤.", a: true, exp: "ì‚¼ê°•í–‰ì‹¤ë„ì—ëŠ” ì¶©ì‹ , íš¨ì ë“±ì˜ ì´ì•¼ê¸°ê°€ ì‹¤ë ¤ ìˆìŠµë‹ˆë‹¤." },
            { q: "ì¡°ì„  ì‹œëŒ€ ì–‘ë°˜ì€ ê³¼ê±°ë¥¼ ì¹˜ëŸ¬ ê´€ë¦¬ê°€ ë  ìˆ˜ ìˆì—ˆë‹¤.", a: true, exp: "ì–‘ë°˜ ë‚¨ì„±ì€ ìœ êµ ê²½ì „ì„ ê³µë¶€í•˜ê³  ê³¼ê±°ì‹œí—˜ì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤." },
            { q: "ì‹ ì‚¬ì„ë‹¹ì€ ì¡°ì„ ì˜ ëŒ€í‘œì ì¸ í™”ê°€ì´ë‹¤.", a: true, exp: "ì‹ ì‚¬ì„ë‹¹ì€ ì‹œ, ê¸€ì”¨, ê·¸ë¦¼ì— ëª¨ë‘ ë›°ì–´ë‚œ ì˜ˆìˆ ê°€ì˜€ìŠµë‹ˆë‹¤." },
            { q: "ì‹ ì‚¬ì„ë‹¹ì˜ ì•„ë“¤ ì´ì´ëŠ” ì¡°ì„ ì„ ëŒ€í‘œí•˜ëŠ” í•™ìê°€ ë˜ì—ˆë‹¤.", a: true, exp: "ì´ì´(ìœ¨ê³¡)ëŠ” ì¡°ì„  ì¤‘ê¸°ì˜ ëŒ€í‘œì ì¸ ìœ í•™ìì…ë‹ˆë‹¤." },
            { q: "ë†ì‚¬ì§ì„¤ì€ ìš°ë¦¬ ë•…ì— ë§ëŠ” ë†ì‚¬ë²•ì„ ì •ë¦¬í•œ ì±…ì´ë‹¤.", a: true, exp: "ì„¸ì¢… ë•Œ ê° ì§€ì—­ ë†ë¯¼ë“¤ì˜ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ë§Œë“  ë†ì‚¬ì±…ì…ë‹ˆë‹¤." },
            { q: "ê´‘í•´êµ°ì€ ëª…ê³¼ í›„ê¸ˆ ì‚¬ì´ì—ì„œ ì¤‘ë¦½ ì™¸êµë¥¼ í¼ì³¤ë‹¤.", a: true, exp: "ê´‘í•´êµ°ì€ ëª…ê³¼ í›„ê¸ˆ ì‚¬ì´ì—ì„œ ê· í˜•ì„ ìœ ì§€í•˜ë ¤ í–ˆìŠµë‹ˆë‹¤." },
            { q: "ê²½ë³µê¶ì€ ì¡°ì„ ì˜ ë‘ ë²ˆì§¸ ê¶ê¶ì´ë‹¤.", a: false, exp: "ê²½ë³µê¶ì€ ì¡°ì„ ì´ ì²« ë²ˆì§¸ë¡œ ì§€ì€ ê¶ê¶ì…ë‹ˆë‹¤." },
            { q: "ìˆ­ë¡€ë¬¸ì€ í•œì–‘ì˜ ë‚¨ìª½ ë¬¸ìœ¼ë¡œ 'ì˜ˆì˜'ë¥¼ ëœ»í•œë‹¤.", a: true, exp: "ìˆ­ë¡€ë¬¸ì€ 'ì˜ˆ(ç¦®)'ë¥¼ ì¡´ì¤‘í•œë‹¤ëŠ” ì˜ë¯¸ë¥¼ ë‹´ì•˜ìŠµë‹ˆë‹¤." },
            { q: "í¥ì¸ì§€ë¬¸ì€ í•œì–‘ì˜ ë™ìª½ ë¬¸ì´ë‹¤.", a: true, exp: "í¥ì¸ì§€ë¬¸ì€ ë™ìª½ ë¬¸ìœ¼ë¡œ 'ì¸ìí•¨(ä»)'ì„ ì¼ìœ¼í‚¨ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤." },
            { q: "í˜¸íŒ¨ëŠ” ì¡°ì„  ì‹œëŒ€ ì‹ ë¶„ì¦ê³¼ ê°™ì€ ì—­í• ì„ í–ˆë‹¤.", a: true, exp: "íƒœì¢… ë•Œ 16ì„¸ ì´ìƒ ë‚¨ìì—ê²Œ í˜¸íŒ¨ë¥¼ ì°¨ê²Œ í•˜ì—¬ ì‹ ë¶„ì„ ì¦ëª…í–ˆìŠµë‹ˆë‹¤." },
            { q: "ì¡°ì„  ì „ê¸°ì—ëŠ” ì‚°ìˆ˜í™”ê°€ ìœ í–‰í•˜ì˜€ë‹¤.", a: true, exp: "ì‚°ê³¼ ë¬¼ì´ ì–´ìš°ëŸ¬ì§„ ìì—°ì„ ê·¸ë¦¬ëŠ” ì‚°ìˆ˜í™”ê°€ ìœ í–‰í–ˆìŠµë‹ˆë‹¤." },
            { q: "ë¶„ì²­ì‚¬ê¸°ì™€ ë°±ìëŠ” ì¡°ì„  ì „ê¸°ì˜ ë„ìê¸°ì´ë‹¤.", a: true, exp: "íšŒì²­ìƒ‰ ë¶„ì²­ì‚¬ê¸°ì™€ í°ìƒ‰ ë°±ìê°€ ì¡°ì„  ì „ê¸°ì— ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤." }
        ];

        // ============ íƒ€ì„ë¼ì¸ ë°ì´í„° ============
        const timelineEvents = [
            { year: 1388, event: "ìœ„í™”ë„ íšŒêµ°" },
            { year: 1392, event: "ì¡°ì„  ê±´êµ­" },
            { year: 1394, event: "í•œì–‘ ì²œë„" },
            { year: 1443, event: "í›ˆë¯¼ì •ìŒ ì°½ì œ" },
            { year: 1485, event: "ê²½êµ­ëŒ€ì „ ì™„ì„±" },
            { year: 1592, event: "ì„ì§„ì™œë€ ë°œë°œ" },
            { year: 1597, event: "ì •ìœ ì¬ë€" },
            { year: 1598, event: "ì„ì§„ì™œë€ ì¢…ë£Œ" },
            { year: 1627, event: "ì •ë¬˜í˜¸ë€" },
            { year: 1636, event: "ë³‘ìí˜¸ë€" }
        ];

        // ============ ê²Œì„ ìƒíƒœ ============
        let oxState = {
            questions: [],
            currentIndex: 0,
            score: 0,
            combo: 1,
            hearts: 3,
            timer: null,
            timeLeft: 100
        };

        let tlState = {
            level: 3,
            round: 1,
            score: 0,
            currentEvents: []
        };

        // ============ OX í€´ì¦ˆ ============
        function startOXQuiz() {
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('oxGame').classList.remove('hidden');

            oxState = {
                questions: shuffleArray([...oxQuestions]).slice(0, 15),
                currentIndex: 0,
                score: 0,
                combo: 1,
                hearts: 3,
                timer: null,
                timeLeft: 100
            };

            updateOXDisplay();
            showOXQuestion();
        }

        function showOXQuestion() {
            if (oxState.currentIndex >= oxState.questions.length || oxState.hearts <= 0) {
                endOXGame();
                return;
            }

            const q = oxState.questions[oxState.currentIndex];
            document.getElementById('oxQuestion').textContent = q.q;
            document.getElementById('oxFeedback').className = 'feedback';
            document.getElementById('oxButtons').querySelectorAll('button').forEach(btn => btn.disabled = false);

            oxState.timeLeft = 100;
            updateTimerBar();
            startTimer();
        }

        function startTimer() {
            clearInterval(oxState.timer);
            oxState.timer = setInterval(() => {
                oxState.timeLeft -= 1.5;
                updateTimerBar();

                if (oxState.timeLeft <= 0) {
                    clearInterval(oxState.timer);
                    answerOX(null);
                }
            }, 100);
        }

        function updateTimerBar() {
            const fill = document.getElementById('timerFill');
            fill.style.width = Math.max(0, oxState.timeLeft) + '%';
            fill.className = 'timer-fill';
            if (oxState.timeLeft <= 30) fill.classList.add('danger');
            else if (oxState.timeLeft <= 50) fill.classList.add('warning');
        }

        function answerOX(answer) {
            clearInterval(oxState.timer);
            document.getElementById('oxButtons').querySelectorAll('button').forEach(btn => btn.disabled = true);

            const q = oxState.questions[oxState.currentIndex];
            const feedback = document.getElementById('oxFeedback');
            const feedbackText = document.getElementById('feedbackText');
            const feedbackExp = document.getElementById('feedbackExplanation');

            if (answer === q.a) {
                const bonus = Math.floor(oxState.timeLeft / 10);
                const points = (10 + bonus) * oxState.combo;
                oxState.score += points;
                oxState.combo = Math.min(oxState.combo + 1, 5);

                feedbackText.textContent = `ì •ë‹µ! +${points}ì `;
                feedbackExp.textContent = q.exp;
                feedback.className = 'feedback correct';
            } else {
                oxState.hearts--;
                oxState.combo = 1;

                if (answer === null) {
                    feedbackText.textContent = 'ì‹œê°„ ì´ˆê³¼!';
                } else {
                    feedbackText.textContent = 'í‹€ë ¸ìŠµë‹ˆë‹¤!';
                }
                feedbackExp.textContent = q.exp;
                feedback.className = 'feedback incorrect';
            }

            updateOXDisplay();
            oxState.currentIndex++;

            setTimeout(() => {
                showOXQuestion();
            }, 2000);
        }

        function updateOXDisplay() {
            document.getElementById('oxScore').textContent = oxState.score;
            document.getElementById('oxCombo').textContent = 'x' + oxState.combo;
            document.getElementById('oxHearts').textContent = 'â¤ï¸'.repeat(oxState.hearts) + 'ğŸ–¤'.repeat(3 - oxState.hearts);
            document.getElementById('oxProgress').textContent = `${Math.min(oxState.currentIndex + 1, oxState.questions.length)} / ${oxState.questions.length}`;
        }

        function endOXGame() {
            clearInterval(oxState.timer);
            document.getElementById('oxGame').classList.add('hidden');
            showResult(oxState.score, 'OX í€´ì¦ˆ');
        }

        // ============ íƒ€ì„ë¼ì¸ ê²Œì„ ============
        function startTimeline() {
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('timelineGame').classList.remove('hidden');

            tlState = { level: 3, round: 1, score: 0, currentEvents: [] };
            updateTLDisplay();
            generateTimelineRound();
        }

        function setLevel(level) {
            tlState.level = level;
            document.querySelectorAll('.level-btn').forEach((btn, i) => {
                btn.classList.toggle('active', [3, 4, 5][i] === level);
            });
            generateTimelineRound();
        }

        function generateTimelineRound() {
            const shuffled = shuffleArray([...timelineEvents]);
            tlState.currentEvents = shuffled.slice(0, tlState.level);

            const container = document.getElementById('timelineCards');
            container.innerHTML = '';

            const displayOrder = shuffleArray([...tlState.currentEvents]);

            displayOrder.forEach((event) => {
                const card = document.createElement('div');
                card.className = 'timeline-card';
                card.draggable = true;
                card.dataset.year = event.year;
                card.innerHTML = `
                    <div class="card-event">${event.event}</div>
                    <div class="card-year">${event.year}ë…„</div>
                `;

                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('drop', handleDrop);

                card.addEventListener('touchstart', handleTouchStart, { passive: false });
                card.addEventListener('touchmove', handleTouchMove, { passive: false });
                card.addEventListener('touchend', handleTouchEnd);

                container.appendChild(card);
            });

            document.getElementById('tlFeedback').className = 'feedback';
            document.getElementById('checkOrderBtn').classList.remove('hidden');
            document.getElementById('nextRoundBtn').classList.add('hidden');
        }

        let draggedCard = null;

        function handleDragStart(e) {
            draggedCard = this;
            this.classList.add('dragging');
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            if (draggedCard !== this) {
                const container = document.getElementById('timelineCards');
                const cards = [...container.children];
                const draggedIndex = cards.indexOf(draggedCard);
                const dropIndex = cards.indexOf(this);

                if (draggedIndex < dropIndex) {
                    this.after(draggedCard);
                } else {
                    this.before(draggedCard);
                }
            }
        }

        let touchCard = null;

        function handleTouchStart(e) {
            touchCard = this;
            this.classList.add('dragging');
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const container = document.getElementById('timelineCards');
            const cards = [...container.children];

            cards.forEach(card => {
                if (card !== touchCard) {
                    const rect = card.getBoundingClientRect();
                    if (touch.clientY > rect.top && touch.clientY < rect.bottom) {
                        const cardIndex = cards.indexOf(card);
                        const touchIndex = cards.indexOf(touchCard);
                        if (touchIndex < cardIndex) {
                            card.after(touchCard);
                        } else {
                            card.before(touchCard);
                        }
                    }
                }
            });
        }

        function handleTouchEnd() {
            if (touchCard) {
                touchCard.classList.remove('dragging');
                touchCard = null;
            }
        }

        function checkTimelineOrder() {
            const container = document.getElementById('timelineCards');
            const cards = [...container.children];
            const years = cards.map(card => parseInt(card.dataset.year));

            let correct = true;
            for (let i = 1; i < years.length; i++) {
                if (years[i] < years[i - 1]) {
                    correct = false;
                    break;
                }
            }

            const feedback = document.getElementById('tlFeedback');

            cards.forEach(card => card.classList.add('show-year'));

            if (correct) {
                const points = tlState.level * 20;
                tlState.score += points;
                feedback.textContent = `ì •ë‹µ! +${points}ì `;
                feedback.className = 'feedback correct';
                cards.forEach(card => card.classList.add('correct'));
            } else {
                feedback.textContent = 'ìˆœì„œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ì—°ë„ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!';
                feedback.className = 'feedback incorrect';

                for (let i = 1; i < years.length; i++) {
                    if (years[i] < years[i - 1]) {
                        cards[i].classList.add('incorrect');
                        cards[i - 1].classList.add('incorrect');
                    }
                }
            }

            updateTLDisplay();
            document.getElementById('checkOrderBtn').classList.add('hidden');
            document.getElementById('nextRoundBtn').classList.remove('hidden');
        }

        function nextTimelineRound() {
            tlState.round++;
            if (tlState.round > 5) {
                endTimelineGame();
            } else {
                updateTLDisplay();
                generateTimelineRound();
            }
        }

        function updateTLDisplay() {
            document.getElementById('tlRound').textContent = tlState.round + ' / 5';
            document.getElementById('tlScore').textContent = tlState.score;
        }

        function endTimelineGame() {
            document.getElementById('timelineGame').classList.add('hidden');
            showResult(tlState.score, 'íƒ€ì„ë¼ì¸');
        }

        // ============ ê²°ê³¼ í™”ë©´ ============
        function showResult(score, gameType) {
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('finalScore').textContent = score;
            document.getElementById('resultText').textContent = `${gameType} ì ìˆ˜`;

            let grade = '';
            if (score >= 200) grade = 'ì—­ì‚¬ ë°•ì‚¬! ğŸ“';
            else if (score >= 150) grade = 'ì—­ì‚¬ ë‹¬ì¸! ğŸ†';
            else if (score >= 100) grade = 'ì—­ì‚¬ ê³ ìˆ˜! â­';
            else if (score >= 50) grade = 'ì—´ì‹¬íˆ ê³µë¶€ì¤‘! ğŸ“š';
            else grade = 'ë‹¤ì‹œ ë„ì „! ğŸ’ª';

            document.getElementById('resultGrade').textContent = grade;
        }

        function backToMenu() {
            clearInterval(oxState.timer);
            document.getElementById('oxGame').classList.add('hidden');
            document.getElementById('timelineGame').classList.add('hidden');
            document.getElementById('result').classList.add('hidden');
            document.getElementById('menu').classList.remove('hidden');
        }

        // ============ ìœ í‹¸ë¦¬í‹° ============
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
